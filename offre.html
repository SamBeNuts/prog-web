<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="Emna">
    <meta name="author" content="Ha">
    <meta name="author" content="Jin Yu">
    <meta name="author" content="Samuel">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INSA - Prog Web</title>
    <link rel="icon" href="img/favicon-96x96.png" type="image/png" sizes="96x96">
    <link rel="stylesheet" type="text/css" href="css/base.css">
    <link rel="stylesheet" type="text/css" href="css/offre.css">
</head>
<body>
<div id="wrapper">
    <header>
        <img src="img/header_bg_offers.jpg" class="bg">
		<a href="index.html"><img src="img/logo_insa_w.png" class="logo_insa"></a>
        <nav role="navigation">
            <div class="menuToggle" onclick="menuToggle(this)">
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
            </div>
            <ul class="menuItems">
                <li><a href="index.html" class="text_white text_shadow">Accueil</a></li>
                <li><a href="offre.html" class="text_white text_shadow">Écoles partenaires</a></li>
                <li><a href="procedure.html" class="text_white text_shadow">Procédure</a></li>
                <li><a href="simu.html" class="text_white text_shadow">Simulation budget</a></li>
                <li><a href="FAQ.html" class="text_white text_shadow">FAQ</a></li>
                <!--<li>FR/EN</li>-->
            </ul>
        </nav>
        <div class="filter">
            <select class="filter_search year" onchange="filter()">
                <option value="">Année</option>
            </select>
            <select class="filter_search department" onchange="filter()">
                <option value="">Orientation</option>
            </select>
            <select class="filter_search language" onchange="filter()">
                <option value="">Langue du Cours</option>
            </select>
            <select class="filter_search country" onchange="filter()">
                <option value="">Pays</option>
            </select>
        </div>
    </header>
	<div class="content">
        <input class="research" type="text" placeholder="Filtrer par nom" onkeyup="filter()">
        <!--<div class="number">-->
            <!--<div class="line"></div>-->
            <!--<p class="nb_result"></p>-->
        <!--</div>-->
        <div class="favoris">
        </div>
		<div class="schools active">
		</div>
	</div>
    <div class="favori_btn" onclick="favoriToggle()">
        <img src="img/favorite.png">
    </div>
    <footer>
        <p class="text_white">Thème, design et code réalisés par <span>E</span>mna, <span>H</span>a,
            <span>J</span>in <span>Y</span>u et <span>S</span>amuel - <a href="sitemap.html" class="text_white">plan
                du site</a></p>
    </footer>
</div>
<script type="text/javascript" src="js/request_data.js"></script>
<script type="text/javascript" src="js/cookies.js"></script>
<script type="text/javascript">
    function menuToggle(x) {
        x.parentElement.classList.toggle("active");
    }

    function favoriToggle() {
        document.querySelector(".favori_btn").classList.toggle("active");
        document.querySelector(".favoris").classList.toggle("active");
        document.querySelector(".schools").classList.toggle("active");
    }

	request.onload = function () {
        let data = request.response;
        let cookies = getCookie('favoris');
        add_filters(data.years, '.year');
        add_filters(data.orientations, '.department');
        add_filters(data.languages, '.language');
        add_filters(data.countries, '.country');
        add_schools(data.schools, Object.keys(data.schools), '.schools');
        if (cookies.toString() !== "") add_schools(data.schools, cookies, '.favoris');
        else document.querySelector(".favori_btn").style.display = 'none';
		//document.querySelector(".nb_result").innerHTML = Object.keys(data.schools).length + ' résultats';
    };

    function add_filters(tab, container){
        for (let i = 0; i<tab.length; i++) document.querySelector(container).innerHTML += "<option value=" + tab[i] + ">" + tab[i] + "</option>";
    }

	function add_schools(schools, schools_name, container) {
        let school_0 = "<a href='offre_details.html?school=";
		let school_1 = "'><div class='school'><img class='image' src='img/data/";
		let school_2 = "'/><div class='over'><div class='info'><p class='text_white'><img src='img/student_icon.png'> ";
		let school_3 = "</p><p class='text_white'><img src='img/rank_icon.png'> the top ";
		let school_4 = "%</p><p class='text_white'><img src='img/language_icon.png'> ";
		let school_5 = " courses</p><p class='text_white'><img src='img/budget_estimated_";
		let school_6 = ".png'/> estimated</p></div><div class='visit'><img src='img/visit_btn.png'></div></div><p class='text_white name'>";
		let school_7 = "</p><div class='city'><div class='line'></div><p class='text_white'>";
		let school_8 = "</p></div></div></a>";

		for(let i=0; i<schools_name.length; i++){
		    let school = schools_name[i];
		    let b = 2;
		    if(schools[school].tuiton_cost + schools[school].campus_cost + schools[school].accomodation_cost < 750) b = 1;
            else if(schools[school].tuiton_cost + schools[school].campus_cost + schools[school].accomodation_cost > 1500) b = 3;
            document.querySelector(container).innerHTML += school_0 + school + school_1 + school.toLowerCase().replace(/ /g, '_') +
                '_thumbnail.jpg' + school_2 + schools[school].courses_year.join(', ') + school_3 + schools[school].top +school_4 +
                schools[school].courses_languages.join(', ') + school_5 + b + school_6 + school + school_7 +
                schools[school].city + ", " + schools[school].country + school_8;
        }
	}

	function filter(){
        let research = document.querySelector('.research').value;
        let year = document.querySelector('.filter .year').value;
        let department = document.querySelector('.filter .department').value;
        let language = document.querySelector('.filter .language').value;
        let country = document.querySelector('.filter .country').value;
        let schools = document.querySelectorAll('.school');
        let school_name = document.querySelectorAll('.school .name');
        let school_city = document.querySelectorAll('.school .city');
        let school_infos = document.querySelectorAll('.school .over .info');
        for (let i=0; i < schools.length; i++){
            if (!school_name[i].innerHTML.toLowerCase().includes(research.toLowerCase()) ||
                !school_infos[i].children[0].innerHTML.toLowerCase().includes(year.toLowerCase()) ||
                !school_infos[i].children[0].innerHTML.toLowerCase().includes(department.toLowerCase()) ||
                !school_infos[i].children[2].innerHTML.toLowerCase().includes(language.toLowerCase()) ||
                !school_city[i].innerHTML.toLowerCase().includes(country.toLowerCase())){
                schools[i].style.display = 'none';
            }else{
                schools[i].style.display = 'inline-block';
            }
        }
    }
</script>
</body>
</html>