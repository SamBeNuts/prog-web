<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="Emna">
    <meta name="author" content="Ha">
    <meta name="author" content="Jin Yu">
    <meta name="author" content="Samuel">
    <meta name="description" content="Prog Web">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INSA - Prog Web</title>
    <link rel="icon" href="img/favicon-96x96.png" type="image/png" sizes="96x96">
    <link rel="stylesheet" type="text/css" href="css/base.css">
    <link rel="stylesheet" type="text/css" href="css/offre_details.css">
</head>
<body>
<div id="wrapper">
    <header>
        <div class="bg_img">
            <img src="img/data/universidad_popular_autónoma_del_estado_de_puebla_bg.jpg" class="bg">
        </div>
        <a href="index.html">
            <img src="img/logo_insa_w.png" class="logo_insa">
        </a>
        <nav role="navigation">
            <div class="menuToggle" onclick="menuToggle(this)">
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
            </div>
            <ul class="menuItems">
                <li><a href="index.html" class="text_white text_shadow">Accueil</a></li>
                <li><a href="offre.html" class="text_white text_shadow">Écoles partenaires</a></li>
                <li><a href="procedure.html" class="text_white text_shadow">Procédure</a></li>
                <li><a href="simu.html" class="text_white text_shadow">Simulation budget</a></li>
                <li><a href="FAQ.html" class="text_white text_shadow">FAQ</a></li>
                <!--<li>FR/EN</li>-->
            </ul>
        </nav>
        <div class="text_bg text_white">
            <p class="text_bg_uni text_shadow_bt name">University of Utah</p>
            <div class="line"></div>
            <p class="txt_bg_city text_shadow city">Salt Lake City,</p>
            <p class="txt_bg_city text_shadow country">United States</p>
        </div>
        <div class="btns">
            <div class="btn favoris" onclick="favoriToggle()">
                <img src="img/favorite.png">
            </div>
            <a class="website" href="">
                <div class="btn">
                    <img src="img/website.png">
                </div>
            </a>
        </div>
    </header>
    <div class="content">
        <div class="left">
            <div class="school_infos">
                <p class="title">Présentation de l'école</p>
                <p class="school_infos_content">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec tempus et
                    quam nec
                    bibendum. Ut et sem mauris. Vivamus eleifend nibh nisl, id hendrerit risus pharetra cursus. Aliquam
                    venenatis semper ipsum, eget molestie mi malesuada eu. Sed vitae erat quam. Donec eu lacus ut metus
                    elementum venenatis sed et lectus. Proin et ligula leo. Aliquam dolor quam, elementum in metus in,
                    lacinia fermentum enim. Suspendisse in aliquet mi. Integer commodo hendrerit blandit. Nulla ac
                    commodo
                    erat. Proin hendrerit elementum finibus. Nulla porta sem ut lacus luctus, in fermentum mi gravida.
                    <br><br> Nulla luctus mollis est, id gravida sapien varius sed. Aliquam nec velit tempor sapien
                    blandit
                    vestibulum scelerisque ullamcorper nisl. Mauris maximus ornare nulla, ac tempor urna varius vitae.
                    Fusce
                    et consequat mauris, quis fringilla erat. In est nulla, condimentum vel imperdiet eget, lacinia
                    mollis
                    urna. Pellentesque sollicitudin et nisl non vestibulum. Proin viverra dui a augue facilisis luctus.
                    Vivamus sapien lectus, iaculis condimentum accumsan et, iaculis non lectus. </p>

            </div>
            <div class="courses">
                <p class="title">Cours disponibles</p>
            </div>
        </div>
        <div class="right not_phone">
            <div class="container">
                <span onclick="this.parentElement.style.display='none'" class="closebtn">&times;
                </span>
                <img id="expandedImg" src="img/video.PNG" style="width:100%">
            </div>
            <img class="gallery_active" src="">
            <div class="gallery">
            </div>
            <div class="chiffres">
                <div class="info"> Le top<br><span class="top">20%</span><br> du classement</div>
                <br>
                <div class="info"> Date limite<br><span class="deadline_number">8</span><br><a class="deadline_date">November,2018</a>
                </div>
            </div>
        </div>
        <div class="costs">
            <p class="title">Coût estimé</p>
            <div class="cost">
                <div class="border_icon">
                    <img src="img/budget_1.png">
                </div>
                <div class="cost_content">
                    <p>FRAIS SCOLAIRES</p>
                    <p class="costDetail"><a class="tuition_cost"></a>€ <span> PAR SEMESTRE</span></p>
                </div>
            </div>
            <div class="cost">
                <div class="border_icon">
                    <img src="img/budget_2.png">
                </div>
                <div class="cost_content">
                    <p class="costDetail">PRIX DU CAMPUS</p>
                    <p class="costDetail"><a class="accomodation_cost"></a>€ <span> PAR SEMESTRE</span></p>
                </div>
            </div>
            <div class="cost">
                <div class="border_icon">
                    <img src="img/budget_3.png">
                </div>
                <div class="cost_content">
                    <p class="costDetail">ESTIMATON DES DÉPENSES COURANTES</p>
                    <p class="costDetail"><a class="campus_cost"></a>€ <span> PAR SEMESTRE</span></p>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p class="text_white">Thème, design et code réalisés par <span>E</span>mna, <span>H</span>a,
            <span>J</span>in <span>Y</span>u et <span>S</span>amuel - <a href="sitemap.html" class="text_white">plan
                du site</a></p>
    </footer>
</div>
<script type="text/javascript" src="js/request_data.js"></script>
<script type="text/javascript" src="js/cookies.js"></script>
<script type="text/javascript">
    let url = window.location.href; //l'url de la page
    let name_school = decodeURI(url.substring(url.lastIndexOf("=") + 1)); //on récupère le nom de l'école depuis l'url

    function menuToggle(x) {
        x.parentElement.classList.toggle("active"); //rajoute/enlève la classe active du burger menu
    }

    function favoriToggle() {
        let favori = document.querySelector('header .favoris'); //le bouton de favoris
        let school = name_school; //le nom de l'école
        let cookies = getCookie("favoris").toString(); //on récupère le cookie des favoris
        if (favori.classList.contains('active')) { //si l'école était en favori
            if (cookies.indexOf(',' + school) !== -1) school = ',' + school; //si l'école n'est pas le seul élément des favoris et n'est pas en première position du tableau
            else if (cookies.indexOf(school + ',') !== -1) school = school + ','; //si l'école n'est pas le seul élément des favoris et est en première position du tableau
            setCookie('favoris', '[' + cookies.replace(school, '') + ']', 60); //on retire l'école des favoris
        } else { //si l'école n'était pas en favori
            if (cookies !== "") school = ',' + school; //si les favoris ne sont pas vides
            setCookie('favoris', '[' + cookies + school + ']', 60); //on rajoute l'école aux favoris
        }
        document.querySelector('header .favoris').classList.toggle("active"); //rajoute/enlève la classe active du bouton de favoris
    }

    function mygallery(imgs) {
        document.querySelector('.gallery_active').src = imgs.src; //change l'image de la gallerie
        document.querySelector('.gallery .column.active').classList.toggle('active'); //rend inactif l'ancienne image de la gallerie
        imgs.parentElement.classList.toggle('active'); //rend actif la nouvelle image de la gallerie
    }

    request.onload = function () { //attend que les données de data.json soient récupérées
        let data = request.response; //on récupère toutes les données de data.json
        let school = data.schools[name_school]; //on stocke seulement les données relatives à l'école passées en paramètre (url)
        //maintenant on injecte les données dans la page
        document.querySelector('.bg').src = 'img/data/' + name_school.toLowerCase().replace(/ /g, '_') + '_bg.jpg'; //on met une image de l'école en background du header
        document.querySelector('.name').innerHTML = name_school; //on met le nom de l'école dans le header
        document.querySelector('.city').innerHTML = school.city + ','; //on précise la ville
        document.querySelector('.country').innerHTML = school.country; //et le pays
        document.querySelector('.website').href = school.website; //on change le lien hypertexte qui mène vers le site de l'école
        document.querySelector('.school_infos_content').innerHTML = school.information; //on injecte les données de "informations générales"
        document.querySelector('.top').innerHTML = school.top + '%'; //le niveau requis pour être accepté dans l'école
        document.querySelector('.deadline_number').innerHTML = school.deadline_number; //le jour limite pour déposer son dossier
        document.querySelector('.deadline_date').innerHTML = school.deadline_date; //le mois et l'année limite pour déposer son dossier
        //les 4 prochaines lignes correspondent au code HTML des cours disponibles dans l'école décomposé en plusieurs strings afin d'y injecter les données relatives au cours
        let courses1 = "<div class=\"course\"><p class=\"name\">";
        let courses2 = "</p><p class=\"year\"> ";
        let courses3 = "</p><p class=\"languages\"><img src=\"img/language_icon_black.png\"> ";
        let courses4 = "</p></div>";
        for (let i = 0; i < school.courses.length; i++) { //on injecte les données pour chaque cours
            document.querySelector('.courses').innerHTML += courses1 + school.courses[i][0] + courses2 + school.courses[i][1].join(', ') + courses3 + school.courses[i][2].join(', ') + courses4;
        }
        if (school.medias.length !== 0){ //si il y a des images à mettre dans la gallerie
            document.querySelector('.gallery_active').src = 'img/data/' + school.medias[0]; //on met une image par défaut dans la gallerie
            let medias1 = "<div class=\"column\"><img src=\"img/data/";
            let medias2 = "\" onclick=\"mygallery(this)\"></div>";
            for (let i = 0; i < school.medias.length; i++) { //on met les différentes images dans la gallerie grâce aux 2 lignes d'au-dessus
                document.querySelector('.gallery').innerHTML += medias1 + school.medias[i] + medias2;
            }
            document.querySelector('.gallery').firstElementChild.classList.toggle('active'); //on rend actif la première image
        } else { //on retire la gallerie de la page
            document.querySelector('.gallery_active').display = 'none';
            document.querySelector('.gallery').display = 'none';
        }
        document.querySelector('.tuition_cost').innerHTML = school.tuiton_cost; //prix du coût d'étude
        document.querySelector('.campus_cost').innerHTML = school.campus_cost; //prix d'un loyer de résidence universitaire
        document.querySelector('.accomodation_cost').innerHTML = school.accomodation_cost; //prix d'un loyer de studio
        let cookies = getCookie("favoris").toString(); //on récupère la valeur du cookie favoris (un tableau avec les écoles mises en favoris)
        if (cookies.indexOf(name_school) !== -1) document.querySelector('header .favoris').classList.toggle("active"); //si l'école appartient au favoris on rend le bouton de favoris actif
    };

</script>
</body>
</html>
