<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="Emna">
    <meta name="author" content="Ha">
    <meta name="author" content="Jin Yu">
    <meta name="author" content="Samuel">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INSA - Prog Web</title>
    <link rel="icon" href="img/favicon-96x96.png" type="image/png" sizes="96x96">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/base.css">
    <link rel="stylesheet" type="text/css" href="css/simu.css">
</head>
<body>
<div id="wrapper">
    <header>
        <img src="img/header_bg_simu.jpg" class="bg">
        <p class="text_bg text_white text_shadow"><span>E</span>stimate<br><span>c</span>ost</p>
        <a href="index.html"><img src="img/logo_insa_w.png" class="logo_insa"></a>
        <nav role="navigation">
            <div class="menuToggle" onclick="menuToggle(this)">
                <div class="line1"></div>
                <div class="line2"></div>
                <div class="line3"></div>
            </div>
            <ul class="menuItems">
                <li><a href="index.html" class="text_white">Accueil</a></li>
                <li><a href="#" class="text_white">Écoles partenaires</a></li>
                <li><a href="procedure.html" class="text_white">Procédure</a></li>
                <li><a href="simu.html" class="text_white">Simulation budget</a></li>
                <li><a href="FAQ.html" class="text_white">FAQ</a></li>
                <!--<li>FR/EN</li>-->
            </ul>
        </nav>
    </header>
    <div class="progress step_1">
        <svg width="500" height="500">
            <circle cx="250" cy="250" r="245" fill="none" stroke="#e6e6e6" stroke-width="10"></circle>
            <circle class="progress__value" cx="250" cy="250" r="245" fill="none" stroke="#d55555" stroke-width="10"></circle>
        </svg>
        <div class="budget_icon budget_icon_2 active" onclick="changeStep(1)">
            <img src="img/budget_step_2.png" class="icon_step">
            <img src="img/budget_step_black_2.png" class="icon_step in">
            <img src="img/budget_step_red_2.png" class="icon_step on">
        </div>
        <div class="budget_icon budget_icon_3" onclick="changeStep(2)">
            <img src="img/budget_step_3.png" class="icon_step">
            <img src="img/budget_step_black_3.png" class="icon_step in">
            <img src="img/budget_step_red_3.png" class="icon_step on">
        </div>
        <div class="budget_icon budget_icon_4" onclick="changeStep(3)">
            <img src="img/budget_step_4.png" class="icon_step">
            <img src="img/budget_step_black_4.png" class="icon_step in">
            <img src="img/budget_step_red_4.png" class="icon_step on">
        </div>
        <div class="budget_icon budget_icon_5" onclick="changeStep(4)">
            <img src="img/budget_step_5.png" class="icon_step">
            <img src="img/budget_step_black_5.png" class="icon_step in">
            <img src="img/budget_step_red_5.png" class="icon_step on">
        </div>
        <div class="budget_icon budget_icon_6" onclick="changeStep(5)">
            <img src="img/budget_step_6.png" class="icon_step">
            <img src="img/budget_step_black_6.png" class="icon_step in">
            <img src="img/budget_step_red_6.png" class="icon_step on">
        </div>
        <div class="budget_icon budget_icon_7" onclick="changeStep(6)">
            <img src="img/budget_step_7.png" class="icon_step">
            <img src="img/budget_step_black_7.png" class="icon_step in">
            <img src="img/budget_step_red_7.png" class="icon_step on">
        </div>
        <div class="budget_icon budget_icon_1" onclick="changeStep(7)">
            <img src="img/budget_step_1.png" class="icon_step">
            <img src="img/budget_step_black_1.png" class="icon_step in">
            <img src="img/budget_step_red_1.png" class="icon_step on">
        </div>
        <div class="form">
            <div class="form_step active">
                <div class="question">
                    <p>Quelle est votre école d'accueil ?</p>
                </div>
                <div class="answer">
                    <input class="research" type="text" placeholder="Nom de l'école" onkeyup="search()">
                    <div class="research_result"></div>
                </div>
            </div>
            <div class="form_step">
                <div class="question">
                    <p>Quelle est votre mois de départ ?</p>
                </div>
                <div class="answer">
                    <select class="month">
                        <option value="1">Janvier</option>
                        <option value="2">Février</option>
                        <option value="3">Mars</option>
                        <option value="4">Avril</option>
                        <option value="5">Mai</option>
                        <option value="6">Juin</option>
                        <option value="7">Juillet</option>
                        <option value="8">Août</option>
                        <option value="9">Septembre</option>
                        <option value="10">Octobre</option>
                        <option value="11">Novembre</option>
                        <option value="12">Décembre</option>
                    </select>
                </div>
                <div class="next" onclick="changeStep(0)">
                    <p>NEXT</p>
                    <img src="img/visit_btn_dark.png" class="next_btn">
                </div>
            </div>
            <div class="form_step">
                <div class="question">
                    <p>Combien de temps partez-vous ?</p>
                </div>
                <div class="answer">
                    <input class="number_months" type="number" min="1" max="24" placeholder="0" onchange="checkNumberMonths()" onkeyup="checkNumberMonths()">
                    <p class="number_months_label">mois</p>
                </div>
                <div class="next next_number_months" onclick="changeStep(0)">
                    <p>NEXT</p>
                    <img src="img/visit_btn_dark.png" class="next_btn">
                </div>
            </div>
            <div class="form_step">
                <div class="question">
                    <p>Quelle sera votre type de logement ?</p>
                </div>
                <div class="answer">
                    <div class="logement" onclick="checkLogement(1)">
                        <img src="img/logement_1.png">
                        <div>
                            <p>Résidence universitaire</p>
                        </div>
                    </div>
                    <div class="logement" onclick="checkLogement(2)">
                        <img src="img/logement_2.png">
                        <div>
                            <p>Studio</p>
                        </div>
                    </div>
                    <div class="logement" onclick="checkLogement(3)">
                        <img src="img/logement_3.png">
                        <div>
                            <p>Colocation</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form_step">
                <div class="question">
                    <p>Montant de vos dépenses courantes :</p>
                </div>
                <div class="answer">
                    <input class="number_months number_euros cost_of_life" type="number" min="0" step="100" placeholder="0">
                    <p class="number_months_label">€/mois</p>
                </div>
                <div class="next" onclick="changeStep(0)">
                    <p>NEXT</p>
                    <img src="img/visit_btn_dark.png" class="next_btn">
                </div>
            </div>
            <div class="form_step">
                <div class="question">
                    <p>Montant de votre bourse d'étude :</p>
                </div>
                <div class="answer">
                    <input class="number_months number_euros scholarship" type="number" min="0" step="100" placeholder="0">
                    <p class="number_months_label">€/mois</p>
                </div>
                <div class="next" onclick="getPrice()">
                    <p>NEXT</p>
                    <img src="img/visit_btn_dark.png" class="next_btn">
                </div>
            </div>
            <div class="form_step">
                <div class="result">
                    <p></p>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p class="text_white">Thème, design et code réalisés par <span>E</span>mna, <span>H</span>a, <span>J</span>in <span>Y</span>u et <span>S</span>amuel - <a href="#" class="text_white">plan du site</a></p>
    </footer>
</div>
<script type="text/javascript" src="js/request_data.js"></script>
<script type="text/javascript">
    let schools;
    let plane_cost;
    let cost_of_living;
    let tuiton_cost;
    let campus_cost;
    let accomodation_cost;
    let type_accomodation;

    request.onload = function () {
        let data = request.response;
        schools = data.schools;
        plane_cost = data.plane_cost;
        cost_of_living = data.cost_of_living;
    };

    function menuToggle(x){
        x.parentElement.classList.toggle("active");
    }

    let pos_step = 1;

    function changeStep(x){
        if ((x === 0 && pos_step !== 7) || (x !== 0 && x < pos_step)){
            document.querySelector('.progress').classList.remove('step_' + pos_step);
            document.querySelector('.budget_icon.active').classList.remove('active');
            document.querySelector('.form_step.active').classList.remove('active');
            if (x === 0){
                pos_step++;
                document.querySelectorAll('.budget_icon').item(pos_step-2).classList.add('done');
                document.querySelectorAll('.budget_icon').item(pos_step-1).classList.add('active');
                document.querySelectorAll('.form_step').item(pos_step-1).classList.add('active');
            }
            else{
                for (let i = pos_step - 1; i >= x; i--){
                    document.querySelectorAll('.budget_icon').item(i-1).classList.remove('done');
                }
                pos_step = x;
            }
            document.querySelector('.progress').classList.add('step_' + pos_step);
            document.querySelectorAll('.budget_icon').item(pos_step-1).classList.add('active');
            document.querySelectorAll('.form_step').item(pos_step-1).classList.add('active');
        }
    }

    function addPrices(d_country, d_tuiton_cost, d_campus_cost, d_accomodation_cost) {
        plane_cost = plane_cost[d_country];
        cost_of_living = cost_of_living[d_country];
        tuiton_cost = d_tuiton_cost;
        campus_cost = d_campus_cost;
        accomodation_cost = d_accomodation_cost;
        changeStep(0);
    }

    function search() {
        let research = document.querySelector('.answer .research').value;
        let research_result = document.querySelector('.answer .research_result');
        research_result.innerHTML = "";
        if (research != ""){
            let nb_result = 0;
            for (let school in schools){
                if (school.toLowerCase().includes(research.toLowerCase())){
                    research_result.innerHTML += "<p onclick='addPrices(\"" + schools[school].country + "\"," + schools[school].tuiton_cost + "," + schools[school].campus_cost + "," + schools[school].accomodation_cost + ")'>" + school + "</p>";
                    nb_result++;
                }
                if (nb_result > 3) break;
            }
        }
    }

    function checkNumberMonths() {
        let nb = document.querySelector('.answer .number_months').value;
        let next_number_months = document.querySelector('.next.next_number_months');
        if (nb > 0 && nb < 25){
            next_number_months.style.display = 'block';
        } else {
            next_number_months.style.display = 'none';
        }
    }

    function checkLogement(x) {
        type_accomodation = x;
        changeStep(0);
    }

    function getPrice() {
        let price = 0;
        let month = parseInt(document.querySelector('.answer .month').value);
        let nb_months = parseInt(document.querySelector('.answer .number_months').value);
        let cost_of_life = parseInt(document.querySelector('.answer .cost_of_life').value);
        let scholarship = parseInt(document.querySelector('.answer .scholarship').value);
        for (let i = month; i<month+nb_months-1; i++){
            if (i%12 === 2 || i%12 === 9){
                if (scholarship !==0) price += 600 + tuiton_cost;
                else price += 200 + tuiton_cost;
                console.log(price);
            }
        }
        price += plane_cost*2;
        console.log(price);
        price += nb_months * (cost_of_life*cost_of_living - scholarship);
        console.log(price);
        switch (type_accomodation){
            case 1:
                price += nb_months * campus_cost;
                break;
            case 2:
                price += nb_months * accomodation_cost;
                break;
            case 3:
                price += nb_months * accomodation_cost * 2 / 3;
                break;
        }
        console.log(price);
        document.querySelector('.result p').innerHTML = Math.round(price) + "€";
        changeStep(0);
    }
</script>
</body>
</html>